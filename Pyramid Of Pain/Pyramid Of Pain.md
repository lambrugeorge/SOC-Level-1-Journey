# 🛡️ Pyramid of Pain: Cybersecurity Insights
![image](pyramid2.png)

The **Pyramid of Pain** is a renowned concept applied in cybersecurity solutions like **Cisco Security**, **SentinelOne**, and **SOCRadar** to boost the effectiveness of:

- 🕵️‍♂️ **Cyber Threat Intelligence (CTI)**
- 🔍 **Threat Hunting**
- 🚨 **Incident Response**

Understanding the Pyramid of Pain is crucial for **Threat Hunters**, **Incident Responders**, and **SOC Analysts**.

---
![image](pyramid.png)
## 🔎 What is the Pyramid of Pain?

Are you ready to explore what hides inside the Pyramid of Pain? Let’s dive in!

---
![image](hash.png)

## 🧩 Hash Values: The Basics

> **Hash Value:**  
> A numeric value of fixed length that uniquely identifies data, generated by a hashing algorithm.

### Common Hashing Algorithms

| Algorithm | Description | Security Status |
|-----------|-------------|----------------|
| **MD5**   | 128-bit hash, defined by RFC 1321, designed by Ron Rivest (1992). | ❌ Not secure (collisions possible) |
| **SHA-1** | 160-bit hash, defined by RFC 3174, invented by NSA (1995). | ❌ Deprecated (brute-force attacks) |
| **SHA-2** | Multiple variants (e.g., SHA-256), designed by NIST & NSA (2001). | ✅ Secure (recommended) |

> **Note:**  
> A hash is **not secure** if two files can have the same hash (collision).

---

## 🦠 Hashes in Malware Analysis

Security professionals use hash values to:

- Identify malware samples
- Reference suspicious files
- Share IOCs (Indicators of Compromise)

You’ll often see hashes in ransomware reports (e.g., [The DFIR Report](https://thedfirreport.com/), [Trellix Threat Research Blogs](https://www.trellix.com/en-us/about/newsroom/stories/threat-labs.html)).

---

## 🛠️ Online Hash Lookup Tools

### 🦠 VirusTotal

Below the hash, you’ll see the filename (e.g., `m_croetian.wnry`).

### ☁️ MetaDefender Cloud - OPSWAT

---

## ⚡ How Easy Is It to Change a Hash?

Even a single bit change in a file creates a new hash!  
**Example:**

```powershell
# Before modification
Get-FileHash .\OpenVPN_2.5.1_I601_amd64.msi -Algorithm MD5
# Output: D1A008E3A606F24590A02B853E955CF7

# Modify the file
echo "AppendTheHash" >> .\OpenVPN_2.5.1_I601_amd64.msi

# After modification
Get-FileHash .\OpenVPN_2.5.1_I601_amd64.msi -Algorithm MD5
# Output: 9D52B46F5DE41B73418F8E0DACEC5E9F
```

---

## ❓ Questions

1. **Analyse the report associated with the hash `b8ef959a9176aef07fdca8705254a163b50b49a17217a4ff0107487f59d4a35d` [here](https://www.virustotal.com/gui/file/b8ef959a9176aef07fdca8705254a163b50b49a17217a4ff0107487f59d4a35d/details). What is the filename of the sample?**

---

## 🌐 IP Addresses in the Pyramid of Pain

An **IP address** identifies any device on a network (PCs, servers, cameras, etc.).

- In the Pyramid of Pain, IP addresses are marked **green** 🟩.
- Blocking malicious IPs is a common defense, but attackers can easily switch IPs.

### Example: Malicious IP Connections
![image](ip1.png)


> **Note:**  
> _Do not interact with the IP addresses shown above!_

---

## 🌀 Fast Flux: Evasion Technique

**Fast Flux** is a DNS technique used by botnets to hide malicious activities behind constantly changing IP addresses.

- Multiple IPs are associated with a single domain.
- Makes it hard for defenders to block or track.
![image](ip2.png)
> For a detailed scenario, see:  
> [Fast Flux 101 by Palo Alto](https://unit42.paloaltonetworks.com/fast-flux-101/)

---

## 📑 Further Reading

- [The DFIR Report](https://thedfirreport.com/)
- [Trellix Threat Research Blogs](https://www.trellix.com/en-us/about/newsroom/stories/threat-labs.html)
- [VirusTotal](https://www.virustotal.com/)
- [MetaDefender Cloud](https://metadefender.opswat.com/)

---

> **Ready to level up your threat hunting skills?** 🚀


# 🛡️ Fast Flux: Techniques for Cyber Resilience and Evasion

> ⚠️ **NOTE!** Do not interact with the IP addresses shown above.

## 📌 What is Fast Flux?

Fast Flux is a DNS technique used by **botnets** to hide malicious activities such as:
- 🧪 malware delivery
- 🕵️ phishing
- 🌐 malicious web proxies
- 🧬 communication with command and control (C&C) servers

🎯 **Goal:** To make it harder for security analysts to detect and block malicious infrastructure.

---

## 🔄 How Does Fast Flux Work?

- Associates **multiple IP addresses** with a single domain name that **constantly changes**.
- The botnet uses **compromised hosts** as proxies to relay traffic to the real servers.
- IPs are **rapidly rotated** via DNS, making takedowns and denylisting extremely difficult.

📚 Example: Palo Alto Networks explains this well in their fictional scenario:  
**"Fast Flux 101: How Cybercriminals Improve the Resilience of Their Infrastructure"**

---

## 📊 Executive Summary

Fast Flux helps attackers:
- 🔐 protect their malicious infrastructure
- ⏫ maintain uptime of illegal operations
- 💸 avoid revenue loss from phishing, scams, botnet rentals, and gambling sites

🆚 While similar to legal practices like RRDNS or CDNs, the **purpose is malicious**.

🔁 Rapid IP rotation via DNS → makes takedowns and denylisting harder

---

## 🧠 Advanced Techniques

### 1️⃣ Single Fast Flux  
- Only the frontend IP addresses change frequently.

### 2️⃣ Double Flux  
- 🔀 DNS resolution (NS records) is also part of the fast flux network → even harder to eliminate.

### 3️⃣ DGA (Domain Generation Algorithms)  
- 🧮 Automatically generates new domain names daily/periodically → nearly impossible to block without the algorithm.

---
![image](raport.png)
## 🕵️‍♂️ Real-World Use Cases

1. 🎭 **Scam campaigns** – social engineering pages in various languages  
2. 🐍 **Smoke Loader malware** – fast flux domains used for C2 infrastructure  
3. 🎰 **Illegal sites (adult content / gambling)** – hosted on resilient, fast-fluxed infrastructures

---

## 🔒 Protection Measures

🛡️ Palo Alto Networks protects against fast flux and DGA-based threats using:
- 🔍 Advanced classifiers
- 📦 Services like URL Filtering and DNS Security

---

> ✍️ Written by:  
**Janos Szurdi, Rebekah Houser, Daiping Liu**  
📅 Published: March 2, 2021  
🏷️ Tags: Botnet, DGA, Double Flux, Phishing, Scam, Malware


## 🟦 Domain Names: Next Level in the Pyramid of Pain

Let's climb higher on the Pyramid of Pain and talk about **Domain Names**! Notice how the color shifts from green (IP addresses) to teal, showing increased difficulty for attackers.

---

### 🌐 What is a Domain Name?

A **domain name** maps an IP address to a human-readable string (like `evilcorp.com`).  
- **Format:**  
       - Domain + Top-Level Domain: `evilcorp.com`
       - Subdomain + Domain + TLD: `tryhackme.evilcorp.com`

We won't dive deep into DNS here, but if you're curious, check out the ["DNS in Detail" Room](#).

![image](domain-name.png)

---

### 🛡️ Why Are Domains Harder to Change?

Attackers need to:
- Purchase/register a domain
- Set up DNS records

But, many DNS providers have loose standards and APIs, making it easier for attackers to swap domains quickly.

---

### 🚩 Malicious Domains in Action

**Example:** Sodinokibi C2 (Command & Control) domains

![image](domain-name2.png)

Can you spot anything suspicious? Compare it to a legitimate website below.

---

### 🕵️‍♂️ Punycode Attacks

Attackers use **Punycode** to create domains that look legitimate but are malicious.

> **What is Punycode?**  
> "Punycode is a way of converting words that cannot be written in ASCII, into a Unicode ASCII encoding." — *Jamf*

**Example:**  
- Looks like: `adıdas.de`  
- Real Punycode: `http://xn--addas-o4a.de/`

Modern browsers (Chrome, Edge, Safari, etc.) now display the true Punycode to help users spot fakes.

---

### 🔎 Detecting Malicious Domains

- Analyze **proxy logs** or **web server logs** for suspicious domains.
- Attackers often use **URL shorteners** to hide malicious links.

**Common URL Shorteners:**
- `bit.ly`
- `goo.gl`
- `ow.ly`
- `s.id`
- `smarturl.it`
- `tiny.pl`
- `tinyurl.com`
- `x.co`

> **Tip:**  
> Add a `+` at the end of a shortened URL (e.g., `tinyurl.com/example+`) to preview the destination.

*Note: The examples above are non-existent and safe.*

---

### 🧪 Analyzing Connections in Any.run

**Any.run** is a sandbox that detonates malware samples and shows their network activity.

#### 🕸️ Tabs to Explore:
- **HTTP Requests:** See what files/resources are fetched (e.g., droppers, callbacks).
- **Connections:** View all communications (e.g., C2 traffic, FTP uploads).
- **DNS Requests:** Check which domains the malware tries to resolve.

> ⚠️ **Caution:**  
> Never visit IPs or URLs from malware reports—they are likely dangerous!

---

### 📝 Quick Quiz

1. **First suspicious domain in the Any.run report:**  
        `craftingalegacy.com`

2. **What term refers to an address used to access websites?**  
        🏷️ **Domain Name**

3. **What type of attack uses Unicode characters in the domain name to imitate a known domain?**  
        🕵️ **Punycode attack**

4. **Preview the redirected website for:**  
        `https://tinyurl.com/bw7t8p4u+`  
        ➡️ `https://tryhackme.com/`

---

Ready to keep climbing the Pyramid of Pain? 🚀



 